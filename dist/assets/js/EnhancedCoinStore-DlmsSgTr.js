import{d as e,j as r,u as t}from"./index-D2UFHVmt.js";import{r as a}from"./react-vendor-D92mXBJ3.js";import{u as l,b as s,c as d}from"./query-vendor-BU1JGbmk.js";import"./mockData-NI8MEqND.js";import{c as i}from"./toast-vendor-D26nLpGL.js";import{c as n,a as c,u as o}from"./forms-vendor-CxwFDm36.js";import{o as m}from"./yup-B8zqhqth.js";import{a5 as x,X as h,h as p,r as b,L as g,O as u,g as N,i as f,S as v,C as y}from"./ui-vendor-CXUW7VoX.js";import{P as w}from"./ProtectedRoute-CPEqnaCT.js";import"./seo-vendor-CXpkBIGe.js";import"./supabase-vendor-BBsrQuQX.js";import"./i18n-vendor-ClAPDSrk.js";const j=n({cardNumber:c().required("Card number is required").matches(/^\d{4}\s\d{4}\s\d{4}\s\d{4}$/,"Invalid card number format"),expiryDate:c().required("Expiry date is required").matches(/^\d{2}\/\d{2}$/,"Invalid expiry date format"),cvv:c().required("CVV is required").matches(/^\d{3,4}$/,"Invalid CVV"),cardName:c().required("Cardholder name is required"),email:c().email("Invalid email").required("Email is required")}),k=({isOpen:e,onClose:t,package:l,onSuccess:s})=>{const[d,i]=a.useState("card"),[n,c]=a.useState(!1),{register:u,handleSubmit:N,formState:{errors:f,isSubmitting:v},setValue:y,watch:w}=o({resolver:m(j)});return w("cardNumber"),w("expiryDate"),e?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:t}),r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-xl rounded-2xl border border-gray-700/50 w-full max-w-lg overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700/50",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(x,{className:"w-6 h-6 text-purple-400"}),r.jsx("h2",{className:"text-xl font-semibold text-white",children:"دفع آمن"})]}),r.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-white transition-colors",children:r.jsx(h,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"p-6 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border-b border-gray-700/50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:l.name}),r.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-300",children:[r.jsxs("span",{children:[l.coins.toLocaleString()," عملة"]}),l.bonus>0&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"+"}),r.jsxs("span",{className:"text-green-400",children:[l.bonus," مكافأة"]})]})]}),r.jsxs("div",{className:"text-3xl font-bold text-white mt-2",children:["$",l.price]})]})}),r.jsx("div",{className:"p-6 border-b border-gray-700/50",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:()=>i("card"),className:"flex-1 p-3 rounded-lg border transition-all "+("card"===d?"border-purple-500 bg-purple-600/20 text-purple-400":"border-gray-600 text-gray-400 hover:border-gray-500"),children:[r.jsx(x,{className:"w-5 h-5 mx-auto mb-1"}),r.jsx("div",{className:"text-xs",children:"بطاقة"})]}),r.jsxs("button",{onClick:()=>i("paypal"),className:"flex-1 p-3 rounded-lg border transition-all "+("paypal"===d?"border-purple-500 bg-purple-600/20 text-purple-400":"border-gray-600 text-gray-400 hover:border-gray-500"),children:[r.jsx("div",{className:"w-5 h-5 mx-auto mb-1 bg-blue-600 rounded text-white text-xs flex items-center justify-center font-bold",children:"PP"}),r.jsx("div",{className:"text-xs",children:"PayPal"})]}),r.jsxs("button",{onClick:()=>i("crypto"),className:"flex-1 p-3 rounded-lg border transition-all "+("crypto"===d?"border-purple-500 bg-purple-600/20 text-purple-400":"border-gray-600 text-gray-400 hover:border-gray-500"),children:[r.jsx("div",{className:"w-5 h-5 mx-auto mb-1 bg-orange-500 rounded text-white text-xs flex items-center justify-center font-bold",children:"₿"}),r.jsx("div",{className:"text-xs",children:"Crypto"})]})]})}),r.jsxs("form",{onSubmit:N(async e=>{c(!0),setTimeout(()=>{c(!1),s({method:d,transactionId:"txn_"+Date.now(),amount:l.price})},3e3)}),className:"p-6",children:["card"===d&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"رقم البطاقة"}),r.jsx("input",{...u("cardNumber"),type:"text",className:"w-full bg-gray-700/50 border rounded-lg px-4 py-3 text-white "+(f.cardNumber?"border-red-500":"border-gray-600"),placeholder:"1234 5678 9012 3456",maxLength:19,onChange:e=>{const r=(e=>{const r=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),t=r.match(/\d{4,16}/g),a=t&&t[0]||"",l=[];for(let s=0,d=a.length;d>s;s+=4)l.push(a.substring(s,s+4));return l.length?l.join(" "):r})(e.target.value);y("cardNumber",r)}}),f.cardNumber&&r.jsx("p",{className:"mt-1 text-sm text-red-400",children:f.cardNumber.message})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"تاريخ الانتهاء"}),r.jsx("input",{...u("expiryDate"),type:"text",className:"w-full bg-gray-700/50 border rounded-lg px-4 py-3 text-white "+(f.expiryDate?"border-red-500":"border-gray-600"),placeholder:"MM/YY",maxLength:5,onChange:e=>{const r=(e=>{const r=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return 2>r.length?r:r.substring(0,2)+"/"+r.substring(2,4)})(e.target.value);y("expiryDate",r)}}),f.expiryDate&&r.jsx("p",{className:"mt-1 text-sm text-red-400",children:f.expiryDate.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"CVV"}),r.jsx("input",{...u("cvv"),type:"text",className:"w-full bg-gray-700/50 border rounded-lg px-4 py-3 text-white "+(f.cvv?"border-red-500":"border-gray-600"),placeholder:"123",maxLength:4}),f.cvv&&r.jsx("p",{className:"mt-1 text-sm text-red-400",children:f.cvv.message})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"اسم حامل البطاقة"}),r.jsx("input",{...u("cardName"),type:"text",className:"w-full bg-gray-700/50 border rounded-lg px-4 py-3 text-white "+(f.cardName?"border-red-500":"border-gray-600"),placeholder:"الاسم كما يظهر على البطاقة"}),f.cardName&&r.jsx("p",{className:"mt-1 text-sm text-red-400",children:f.cardName.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"البريد الإلكتروني"}),r.jsx("input",{...u("email"),type:"email",className:"w-full bg-gray-700/50 border rounded-lg px-4 py-3 text-white "+(f.email?"border-red-500":"border-gray-600"),placeholder:"للإيصال"}),f.email&&r.jsx("p",{className:"mt-1 text-sm text-red-400",children:f.email.message})]})]}),"paypal"===d&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("span",{className:"text-white font-bold text-xl",children:"PP"})}),r.jsx("p",{className:"text-gray-300 mb-4",children:"سيتم توجيهك إلى PayPal لإكمال الدفع"})]}),"crypto"===d&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("span",{className:"text-white font-bold text-xl",children:"₿"})}),r.jsx("p",{className:"text-gray-300 mb-4",children:"ادفع بالبيتكوين أو العملات الرقمية الأخرى"})]}),r.jsx("div",{className:"bg-green-900/20 border border-green-500/30 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(p,{className:"w-5 h-5 text-green-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-green-400 text-sm font-medium",children:"دفع آمن"}),r.jsx("p",{className:"text-gray-400 text-xs",children:"معلومات الدفع مشفرة وآمنة"})]})]})}),r.jsx("button",{type:"submit",disabled:n||v,className:"w-full py-3 rounded-lg font-semibold transition-all flex items-center justify-center space-x-2 "+(n||v?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white"),children:n||v?r.jsxs(r.Fragment,{children:[r.jsx(b,{className:"w-5 h-5 animate-spin"}),r.jsx("span",{children:"جاري المعالجة..."})]}):r.jsxs("span",{children:["دفع $",l.price]})})]}),r.jsx("div",{className:"p-6 border-t border-gray-700/50 text-center",children:r.jsxs("div",{className:"flex items-center justify-center space-x-4 text-gray-400 text-xs",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(g,{className:"w-3 h-3"}),r.jsx("span",{children:"تشفير SSL"})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(p,{className:"w-3 h-3"}),r.jsx("span",{children:"متوافق مع PCI"})]})]})})]})})]}):null},P=({onBack:n})=>{const{userProfile:c}=t(),{purchaseCoins:o,isPurchasing:m}=(r=>{const t=l(),{data:a,isLoading:n,error:c}=s(["transactions",r],async()=>{try{const{data:t,error:a}=await e.getUserTransactions(r);if(a)throw a;return{data:[],error:null}}catch(t){return{data:[],error:null}}},{enabled:!!r,select:e=>e.data||[]}),o=d(async e=>({data:{id:"txn_"+Date.now(),...e},error:null}),{onSuccess:()=>{t.invalidateQueries(["transactions",r]),t.invalidateQueries(["user",r])},onError:e=>{i.error(e.message||"Transaction failed")}}),m=d(async({packageId:e,amount:r,paymentMethod:t})=>(i.success(`تم شراء ${r} عملة بنجاح!`),{data:{id:"txn_"+Date.now()},error:null}),{onError:e=>{i.error(e.message||"Purchase failed")}});return{transactions:a||[],isLoading:n,error:c,createTransaction:o.mutate,purchaseCoins:m.mutate,isPurchasing:m.isLoading}})((null==c?void 0:c.id)||""),[h,b]=a.useState(null),[g,j]=a.useState(!1);return r.jsx(w,{requireAuth:!0,children:r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900",children:[r.jsx("div",{className:"bg-gray-800/50 backdrop-blur-lg border-b border-gray-700",children:r.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("button",{onClick:n,className:"flex items-center text-purple-400 hover:text-purple-300 transition-colors",children:[r.jsx(u,{className:"w-5 h-5 mr-2"}),"العودة"]}),r.jsxs("div",{className:"flex items-center bg-gray-700/50 px-4 py-2 rounded-lg",children:[r.jsx(N,{className:"w-5 h-5 text-gold mr-2"}),r.jsxs("span",{className:"text-white font-semibold",children:["الرصيد الحالي: $",((null==c?void 0:c.balance)||0).toFixed(2)]})]})]})})}),r.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[r.jsxs("div",{className:"text-center mb-12",children:[r.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-400 to-gold bg-clip-text text-transparent mb-4",children:"إضافة عملات لحسابك"}),r.jsx("p",{className:"text-gray-400 text-lg",children:"اشتري العملات للاستمتاع بمكالمات فيديو مميزة مع عارضاتنا"})]}),r.jsx("div",{className:"bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-2xl p-6 border border-green-500/20 mb-10",children:r.jsxs("div",{className:"flex items-center justify-center space-x-4 text-center",children:[r.jsx(p,{className:"w-8 h-8 text-green-400"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"مدفوعات آمنة ومشفرة"}),r.jsx("p",{className:"text-gray-300 text-sm",children:"جميع المعاملات محمية بتشفير SSL وتتوافق مع معايير PCI DSS"})]})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:[{id:"starter",name:"المبتدئ",coins:100,price:9.99,bonus:0},{id:"popular",name:"الشائع",coins:250,price:19.99,bonus:25,popular:!0,savings:"وفر 20%"},{id:"premium",name:"المميز",coins:500,price:34.99,bonus:75,savings:"وفر 30%"},{id:"vip",name:"VIP",coins:1e3,price:59.99,bonus:200,savings:"وفر 40%"}].map(e=>r.jsxs("div",{className:"relative bg-gray-800/50 backdrop-blur-lg rounded-2xl p-6 border transition-all duration-300 hover:scale-105 hover:shadow-2xl group "+(e.popular?"border-purple-500 shadow-purple-500/20 ring-2 ring-purple-500/20":"border-gray-700 hover:border-purple-500/50"),children:[e.popular&&r.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:r.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center",children:[r.jsx(f,{className:"w-4 h-4 mr-1"}),"الأكثر شعبية"]})}),e.savings&&r.jsx("div",{className:"absolute -top-2 -right-2",children:r.jsx("div",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-xs font-semibold",children:e.savings})}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:e.name}),r.jsx("div",{className:"text-3xl font-bold text-purple-400 mb-1",children:e.coins.toLocaleString()}),r.jsx("div",{className:"text-gray-400 text-sm",children:"عملة"}),e.bonus>0&&r.jsx("div",{className:"text-green-400 text-sm font-semibold mt-2 flex items-center justify-center",children:r.jsxs("span",{children:["+",e.bonus," مكافأة!"]})})]}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",e.price]}),r.jsx("div",{className:"text-gray-400 text-sm",children:"دولار أمريكي"}),e.bonus>0&&r.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:["المجموع: ",(e.coins+e.bonus).toLocaleString()," عملة"]})]}),r.jsx("button",{onClick:()=>(e=>{b(e),j(!0)})(e),disabled:m,className:"w-full py-3 px-4 rounded-lg font-semibold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed "+(e.popular?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-lg hover:shadow-purple-500/25":"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white"),children:m?"جاري الشراء...":"شراء الآن"}),r.jsx("div",{className:"mt-4 text-center",children:r.jsxs("div",{className:"text-xs text-gray-400",children:["≈ ",Math.floor(e.coins/3.5)," دقيقة مكالمة"]})})]},e.id))}),r.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-lg rounded-2xl p-8 border border-gray-700 mb-10",children:[r.jsx("h2",{className:"text-2xl font-bold text-white mb-6 text-center",children:"طرق الدفع الآمنة"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[r.jsxs("div",{className:"flex items-center justify-center p-6 bg-gray-700/50 rounded-lg",children:[r.jsx(x,{className:"w-8 h-8 text-blue-400 mr-3"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white font-semibold",children:"البطاقات الائتمانية"}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Visa, Mastercard, Amex"})]})]}),r.jsxs("div",{className:"flex items-center justify-center p-6 bg-gray-700/50 rounded-lg",children:[r.jsx(v,{className:"w-8 h-8 text-green-400 mr-3"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white font-semibold",children:"المحافظ الرقمية"}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Apple Pay, Google Pay"})]})]}),r.jsxs("div",{className:"flex items-center justify-center p-6 bg-gray-700/50 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded mr-3 flex items-center justify-center text-white font-bold text-sm",children:"PP"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white font-semibold",children:"PayPal"}),r.jsx("div",{className:"text-gray-400 text-sm",children:"آمن وسريع"})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-gray-400 text-sm",children:[r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(p,{className:"w-6 h-6 text-green-400 mb-2"}),r.jsx("span",{children:"تشفير SSL"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(y,{className:"w-6 h-6 text-green-400 mb-2"}),r.jsx("span",{children:"دفع فوري"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(x,{className:"w-6 h-6 text-blue-400 mb-2"}),r.jsx("span",{children:"PCI متوافق"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(N,{className:"w-6 h-6 text-gold mb-2"}),r.jsx("span",{children:"إضافة فورية"})]})]})]}),r.jsxs("div",{className:"bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-2xl p-8 border border-purple-500/20",children:[r.jsx("h2",{className:"text-2xl font-bold text-white mb-6 text-center",children:"عروض خاصة"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-4xl mb-4",children:"🎁"}),r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"مكافأة الشراء الأول"}),r.jsx("p",{className:"text-gray-300 text-sm",children:"احصل على 50% عملات إضافية في أول عملية شراء!"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-4xl mb-4",children:"⭐"}),r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"عضوية VIP"}),r.jsx("p",{className:"text-gray-300 text-sm",children:"اشتري بقيمة 100$ أو أكثر واحصل على ميزات حصرية!"})]})]})]})]}),g&&h&&r.jsx(k,{isOpen:g,onClose:()=>{j(!1),b(null)},package:h,onSuccess:e=>{h&&o({packageId:h.id,amount:h.coins+h.bonus,paymentMethod:e.method}),j(!1),b(null)}})]})})};export{P as EnhancedCoinStore};
