import{a as t,c as e}from"./react-vendor-D92mXBJ3.js";const i={},s=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),s=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));r=Promise.allSettled(e.map(t=>{if((t=function(t){return"/"+t}(t))in i)return;i[t]=!0;const e=t.endsWith(".css"),r=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${r}`))return;const n=document.createElement("link");return n.rel=e?"stylesheet":"modulepreload",e||(n.as="script"),n.crossOrigin="",n.href=t,s&&n.setAttribute("nonce",s),document.head.appendChild(n),e?new Promise((e,i)=>{n.addEventListener("load",e),n.addEventListener("error",()=>i(Error("Unable to preload CSS for "+t)))}):void 0}))}function n(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then(e=>{for(const t of e||[])"rejected"===t.status&&n(t.reason);return t().catch(n)})};class r extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class n extends r{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class o extends r{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class a extends r{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var h,l;(l=h||(h={})).Any="any",l.ApNortheast1="ap-northeast-1",l.ApNortheast2="ap-northeast-2",l.ApSouth1="ap-south-1",l.ApSoutheast1="ap-southeast-1",l.ApSoutheast2="ap-southeast-2",l.CaCentral1="ca-central-1",l.EuCentral1="eu-central-1",l.EuWest1="eu-west-1",l.EuWest2="eu-west-2",l.EuWest3="eu-west-3",l.SaEast1="sa-east-1",l.UsEast1="us-east-1",l.UsWest1="us-west-1",l.UsWest2="us-west-2";class c{constructor(t,{headers:e={},customFetch:i,region:r=h.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>s(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(i)}setAuth(t){this.headers.Authorization="Bearer "+t}invoke(t,e={}){var i,s,r,h;return s=this,h=function*(){try{const{headers:s,method:r,body:h}=e;let l={},{region:c}=e;c||(c=this.region);const u=new URL(`${this.url}/${t}`);let d;c&&"any"!==c&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c)),h&&(s&&!{}.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&h instanceof Blob||h instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=h):"string"==typeof h?(l["Content-Type"]="text/plain",d=h):"undefined"!=typeof FormData&&h instanceof FormData?d=h:(l["Content-Type"]="application/json",d=JSON.stringify(h)));const f=yield this.fetch(u.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:d}).catch(t=>{throw new n(t)}),v=f.headers.get("x-relay-error");if(v&&"true"===v)throw new o(f);if(!f.ok)throw new a(f);let w,y=(null!==(i=f.headers.get("Content-Type"))&&void 0!==i?i:"text/plain").split(";")[0].trim();return w="application/json"===y?yield f.json():"application/octet-stream"===y?yield f.blob():"text/event-stream"===y?f:"multipart/form-data"===y?yield f.formData():yield f.text(),{data:w,error:null,response:f}}catch(s){return{data:null,error:s,response:s instanceof a||s instanceof o?s.context:void 0}}},new((r=void 0)||(r=Promise))(function(t,e){function i(t){try{o(h.next(t))}catch(i){e(i)}}function n(t){try{o(h.throw(t))}catch(i){e(i)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r(function(t){t(s)})).then(i,n)}o((h=h.call(s)).next())})}}var u={},d={},f={},v={},w={},y={},p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();const b=p.fetch,g=p.fetch.bind(p),m=p.Headers,_=p.Request,j=p.Response,k=Object.freeze(Object.defineProperty({__proto__:null,Headers:m,Request:_,Response:j,default:g,fetch:b},Symbol.toStringTag,{value:"Module"})),O=t(k);var S={};Object.defineProperty(S,"t",{value:!0}),S.default=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};var E=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(y,"t",{value:!0});const T=E(O),x=E(S);y.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=T.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,i,s;let r=null,n=null,o=null,a=t.status,h=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const s=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),l=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");s&&l&&l.length>1&&(o=parseInt(l[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(r={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,o=null,a=406,h="Not Acceptable"):n=1===n.length?n[0]:null)}else{const e=await t.text();try{r=JSON.parse(e),Array.isArray(r)&&404===t.status&&(n=[],r=null,a=200,h="OK")}catch(l){404===t.status&&""===e?(a=204,h="No Content"):r={message:e}}if(r&&this.isMaybeSingle&&(null===(s=null==r?void 0:r.details)||void 0===s?void 0:s.includes("0 rows"))&&(r=null,a=200,h="OK"),r&&this.shouldThrowOnError)throw new x.default(r)}return{error:r,data:n,count:o,status:a,statusText:h}});return this.shouldThrowOnError||(i=i.catch(t=>{var e,i,s;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:""+(null!==(i=null==t?void 0:t.stack)&&void 0!==i?i:""),hint:"",code:""+(null!==(s=null==t?void 0:t.code)&&void 0!==s?s:"")},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}};var $=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(w,"t",{value:!0});const P=$(y);let A=class extends P.default{select(t){let e=!1;const i=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:s,referencedTable:r=s}={}){const n=r?r+".order":"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?o+",":""}${t}.${e?"asc":"desc"}${void 0===i?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){const s=void 0===i?"limit":i+".limit";return this.url.searchParams.set(s,""+t),this}range(t,e,{foreignTable:i,referencedTable:s=i}={}){const r=void 0===s?"offset":s+".offset",n=void 0===s?"limit":s+".limit";return this.url.searchParams.set(r,""+t),this.url.searchParams.set(n,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:s=!1,wal:r=!1,format:n="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,i?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),h=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${h}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};w.default=A;var I=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(v,"t",{value:!0});const R=I(w);let U=class extends R.default{eq(t,e){return this.url.searchParams.append(t,"eq."+e),this}neq(t,e){return this.url.searchParams.append(t,"neq."+e),this}gt(t,e){return this.url.searchParams.append(t,"gt."+e),this}gte(t,e){return this.url.searchParams.append(t,"gte."+e),this}lt(t,e){return this.url.searchParams.append(t,"lt."+e),this}lte(t,e){return this.url.searchParams.append(t,"lte."+e),this}like(t,e){return this.url.searchParams.append(t,"like."+e),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,"ilike."+e),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,"is."+e),this}in(t,e){const i=Array.from(new Set(e)).map(t=>"string"==typeof t&&RegExp("[,()]").test(t)?`"${t}"`:""+t).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cs."+e):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,"cs."+JSON.stringify(e)),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cd."+e):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,"cd."+JSON.stringify(e)),this}rangeGt(t,e){return this.url.searchParams.append(t,"sr."+e),this}rangeGte(t,e){return this.url.searchParams.append(t,"nxl."+e),this}rangeLt(t,e){return this.url.searchParams.append(t,"sl."+e),this}rangeLte(t,e){return this.url.searchParams.append(t,"nxr."+e),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,"adj."+e),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,"ov."+e):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:s}={}){let r="";"plain"===s?r="pl":"phrase"===s?r="ph":"websearch"===s&&(r="w");const n=void 0===i?"":`(${i})`;return this.url.searchParams.append(t,`${r}fts${n}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,"eq."+e)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){const s=i?i+".or":"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};v.default=U;var N=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(f,"t",{value:!0});const D=N(v);f.default=class{constructor(t,{headers:e={},schema:i,fetch:s}){this.url=t,this.headers=e,this.schema=i,this.fetch=s}select(t,{head:e=!1,count:i}={}){const s=e?"HEAD":"GET";let r=!1;const n=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!r?"":('"'===t&&(r=!r),t)).join("");return this.url.searchParams.set("select",n),i&&(this.headers.Prefer="count="+i),new D.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:i=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push("count="+e),i||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new D.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:s,defaultToNull:r=!0}={}){const n=[`resolution=${i?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push("count="+s),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new D.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){const i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push("count="+e),this.headers.Prefer=i.join(","),new D.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const e=[];return t&&e.push("count="+t),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new D.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var C={},L={};Object.defineProperty(L,"t",{value:!0}),L.version=void 0,L.version="0.0.0-automated",Object.defineProperty(C,"t",{value:!0}),C.DEFAULT_HEADERS=void 0;const B=L;C.DEFAULT_HEADERS={"X-Client-Info":"postgrest-js/"+B.version};var F=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(d,"t",{value:!0});const J=F(f),M=F(v),G=C;d.default=class t{constructor(t,{headers:e={},schema:i,fetch:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},G.DEFAULT_HEADERS),e),this.schemaName=i,this.fetch=s}from(t){const e=new URL(`${this.url}/${t}`);return new J.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:s=!1,count:r}={}){let n;const o=new URL(`${this.url}/rpc/${t}`);let a;i||s?(n=i?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:""+e]).forEach(([t,e])=>{o.searchParams.append(t,e)})):(n="POST",a=e);const h=Object.assign({},this.headers);return r&&(h.Prefer="count="+r),new M.default({method:n,url:o,headers:h,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var q=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(u,"t",{value:!0}),u.PostgrestError=u.PostgrestBuilder=u.PostgrestTransformBuilder=u.PostgrestFilterBuilder=u.PostgrestQueryBuilder=u.PostgrestClient=void 0;const z=q(d);u.PostgrestClient=z.default;const W=q(f);u.PostgrestQueryBuilder=W.default;const H=q(v);u.PostgrestFilterBuilder=H.default;const V=q(w);u.PostgrestTransformBuilder=V.default;const K=q(y);u.PostgrestBuilder=K.default;const Y=q(S);u.PostgrestError=Y.default;var X=u.default={PostgrestClient:z.default,PostgrestQueryBuilder:W.default,PostgrestFilterBuilder:H.default,PostgrestTransformBuilder:V.default,PostgrestBuilder:K.default,PostgrestError:Y.default};const{PostgrestClient:Q,PostgrestQueryBuilder:Z,PostgrestFilterBuilder:tt,PostgrestTransformBuilder:et,PostgrestBuilder:it,PostgrestError:st}=X,rt=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw Error("`WebSocket` is not supported in this environment")}();var nt,ot,at,ht,lt,ct,ut,dt,ft,vt,wt;(ot=nt||(nt={}))[ot.connecting=0]="connecting",ot[ot.open=1]="open",ot[ot.closing=2]="closing",ot[ot.closed=3]="closed",(ht=at||(at={})).closed="closed",ht.errored="errored",ht.joined="joined",ht.joining="joining",ht.leaving="leaving",(ct=lt||(lt={})).close="phx_close",ct.error="phx_error",ct.join="phx_join",ct.reply="phx_reply",ct.leave="phx_leave",ct.access_token="access_token",(ut||(ut={})).websocket="websocket",(ft=dt||(dt={})).Connecting="connecting",ft.Open="open",ft.Closing="closing",ft.Closed="closed";class yt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.o(t)):e("string"==typeof t?JSON.parse(t):{})}o(t){const e=new DataView(t),i=new TextDecoder;return this.h(t,e,i)}h(t,e,i){const s=e.getUint8(1),r=e.getUint8(2);let n=this.HEADER_LENGTH+2;const o=i.decode(t.slice(n,n+s));n+=s;const a=i.decode(t.slice(n,n+r));return n+=r,{ref:null,topic:o,event:a,payload:JSON.parse(i.decode(t.slice(n,t.byteLength)))}}}class pt{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(wt=vt||(vt={})).abstime="abstime",wt.bool="bool",wt.date="date",wt.daterange="daterange",wt.float4="float4",wt.float8="float8",wt.int2="int2",wt.int4="int4",wt.int4range="int4range",wt.int8="int8",wt.int8range="int8range",wt.json="json",wt.jsonb="jsonb",wt.money="money",wt.numeric="numeric",wt.oid="oid",wt.reltime="reltime",wt.text="text",wt.time="time",wt.timestamp="timestamp",wt.timestamptz="timestamptz",wt.timetz="timetz",wt.tsrange="tsrange",wt.tstzrange="tstzrange";const bt=(t,e,i={})=>{var s;const r=null!==(s=i.skipTypes)&&void 0!==s?s:[];return Object.keys(e).reduce((i,s)=>(i[s]=gt(s,t,e,r),i),{})},gt=(t,e,i,s)=>{const r=e.find(e=>e.name===t),n=null==r?void 0:r.type,o=i[t];return n&&!s.includes(n)?mt(n,o):_t(o)},mt=(t,e)=>{if("_"===t.charAt(0)){const i=t.slice(1,t.length);return St(e,i)}switch(t){case vt.bool:return jt(e);case vt.float4:case vt.float8:case vt.int2:case vt.int4:case vt.int8:case vt.numeric:case vt.oid:return kt(e);case vt.json:case vt.jsonb:return Ot(e);case vt.timestamp:return Et(e);case vt.abstime:case vt.date:case vt.daterange:case vt.int4range:case vt.int8range:case vt.money:case vt.reltime:case vt.text:case vt.time:case vt.timestamptz:case vt.timetz:case vt.tsrange:case vt.tstzrange:default:return _t(e)}},_t=t=>t,jt=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},kt=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Ot=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},St=(t,e)=>{if("string"!=typeof t)return t;const i=t.length-1,s=t[i];if("{"===t[0]&&"}"===s){let s;const n=t.slice(1,i);try{s=JSON.parse("["+n+"]")}catch(r){s=n?n.split(","):[]}return s.map(t=>mt(e,t))}return t},Et=t=>"string"==typeof t?t.replace(" ","T"):t,Tt=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class xt{constructor(t,e,i={},s=1e4){this.channel=t,this.event=e,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.l(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.u("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.v()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this.u(t)&&e(null===(i=this.receivedResp)||void 0===i?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.p(),this.refEvent=this.channel.m(this.ref),this.channel._(this.refEvent,{},t=>{this.l(),this.j(),this.receivedResp=t,this.k(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.O(this.refEvent,{status:t,response:e})}destroy(){this.l(),this.j()}l(){this.refEvent&&this.channel.S(this.refEvent,{})}j(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}k({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}u(t){return this.receivedResp&&this.receivedResp.status===t}}var $t,Pt,At,It,Rt,Ut,Nt,Dt;(Pt=$t||($t={})).SYNC="sync",Pt.JOIN="join",Pt.LEAVE="leave";class Ct{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._(i.state,{},t=>{const{onJoin:e,onLeave:i,onSync:s}=this.caller;this.joinRef=this.channel.v(),this.state=Ct.syncState(this.state,t,e,i),this.pendingDiffs.forEach(t=>{this.state=Ct.syncDiff(this.state,t,e,i)}),this.pendingDiffs=[],s()}),this.channel._(i.diff,{},t=>{const{onJoin:e,onLeave:i,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=Ct.syncDiff(this.state,t,e,i),s())}),this.onJoin((t,e,i)=>{this.channel.O("presence",{event:"join",key:t,currentPresences:e,newPresences:i})}),this.onLeave((t,e,i)=>{this.channel.O("presence",{event:"leave",key:t,currentPresences:e,leftPresences:i})}),this.onSync(()=>{this.channel.O("presence",{event:"sync"})})}static syncState(t,e,i,s){const r=this.cloneDeep(t),n=this.transformState(e),o={},a={};return this.map(r,(t,e)=>{n[t]||(a[t]=e)}),this.map(n,(t,e)=>{const i=r[t];if(i){const s=e.map(t=>t.presence_ref),r=i.map(t=>t.presence_ref),n=e.filter(t=>0>r.indexOf(t.presence_ref)),h=i.filter(t=>0>s.indexOf(t.presence_ref));n.length>0&&(o[t]=n),h.length>0&&(a[t]=h)}else o[t]=e}),this.syncDiff(r,{joins:o,leaves:a},i,s)}static syncDiff(t,e,i,s){const{joins:r,leaves:n}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),s||(s=()=>{}),this.map(r,(e,s)=>{var r;const n=null!==(r=t[e])&&void 0!==r?r:[];if(t[e]=this.cloneDeep(s),n.length>0){const i=t[e].map(t=>t.presence_ref),s=n.filter(t=>0>i.indexOf(t.presence_ref));t[e].unshift(...s)}i(e,n,s)}),this.map(n,(e,i)=>{let r=t[e];if(!r)return;const n=i.map(t=>t.presence_ref);r=r.filter(t=>0>n.indexOf(t.presence_ref)),t[e]=r,s(e,r,i),0===r.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const s=t[i];return e[i]="metas"in s?s.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):s,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.v()}}(It=At||(At={})).ALL="*",It.INSERT="INSERT",It.UPDATE="UPDATE",It.DELETE="DELETE",(Ut=Rt||(Rt={})).BROADCAST="broadcast",Ut.PRESENCE="presence",Ut.POSTGRES_CHANGES="postgres_changes",Ut.SYSTEM="system",(Dt=Nt||(Nt={})).SUBSCRIBED="SUBSCRIBED",Dt.TIMED_OUT="TIMED_OUT",Dt.CLOSED="CLOSED",Dt.CHANNEL_ERROR="CHANNEL_ERROR";class Lt{constructor(t,e={config:{}},i){this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=at.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new xt(this,lt.join,this.params,this.timeout),this.rejoinTimer=new pt(()=>this.T(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=at.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.$(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.v()}`),this.state=at.closed,this.socket.P(this)}),this.A(t=>{this.I()||this.R()||(this.socket.log("channel","error "+this.topic,t),this.state=at.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.U()&&(this.socket.log("channel","timeout "+this.topic,this.joinPush.timeout),this.state=at.errored,this.rejoinTimer.scheduleTimeout())}),this._(lt.reply,{},(t,e)=>{this.O(this.m(e),t)}),this.presence=new Ct(this),this.broadcastEndpointURL=Tt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==at.closed){const{config:{broadcast:r,presence:n,private:o}}=this.params;this.A(e=>null==t?void 0:t(Nt.CHANNEL_ERROR,e)),this.$(()=>null==t?void 0:t(Nt.CLOSED));const a={},h={broadcast:r,presence:n,postgres_changes:null!==(s=null===(i=this.bindings.postgres_changes)||void 0===i?void 0:i.map(t=>t.filter))&&void 0!==s?s:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this.N(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var i;if(this.socket.setAuth(),void 0!==e){const s=this.bindings.postgres_changes,r=null!==(i=null==s?void 0:s.length)&&void 0!==i?i:0,n=[];for(let i=0;r>i;i++){const r=s[i],{filter:{event:o,schema:a,table:h,filter:l}}=r,c=e&&e[i];if(!c||c.event!==o||c.schema!==a||c.table!==h||c.filter!==l)return this.unsubscribe(),this.state=at.errored,void(null==t||t(Nt.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},r),{id:c.id}))}return this.bindings.postgres_changes=n,void(t&&t(Nt.SUBSCRIBED))}null==t||t(Nt.SUBSCRIBED)}).receive("error",e=>{this.state=at.errored,null==t||t(Nt.CHANNEL_ERROR,Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(Nt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,i){return this._(t,e,i)}async send(t,e={}){var i,s;if(this.D()||"broadcast"!==t.type)return new Promise(i=>{var s,r,n;const o=this.C(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(n=null===(r=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.ack)||i("ok"),o.receive("ok",()=>i("ok")),o.receive("error",()=>i("error")),o.receive("timeout",()=>i("timed out"))});{const{event:n,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer "+this.socket.accessTokenValue:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const t=await this.L(this.broadcastEndpointURL,a,null!==(i=e.timeout)&&void 0!==i?i:this.timeout);return await(null===(s=t.body)||void 0===s?void 0:s.cancel()),t.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=at.leaving;const e=()=>{this.socket.log("channel","leave "+this.topic),this.O(lt.close,"leave",this.v())};this.joinPush.destroy();let i=null;return new Promise(s=>{i=new xt(this,lt.leave,{},t),i.receive("ok",()=>{e(),s("ok")}).receive("timeout",()=>{e(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this.D()||i.trigger("ok",{})}).finally(()=>{null==i||i.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async L(t,e,i){const s=new AbortController,r=setTimeout(()=>s.abort(),i),n=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(r),n}C(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new xt(this,t,e,i);return this.D()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}B(t,e,i){return e}F(t){return this.topic===t}v(){return this.joinPush.ref}O(t,e,i){var s,r;const n=t.toLocaleLowerCase(),{close:o,error:a,leave:h,join:l}=lt;if(i&&[o,a,h,l].indexOf(n)>=0&&i!==this.v())return;let c=this.B(n,e,i);if(e&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(t=>{var e,i,s;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(s=null===(i=t.filter)||void 0===i?void 0:i.event)||void 0===s?void 0:s.toLocaleLowerCase())===n}).map(t=>t.callback(c,i)):null===(r=this.bindings[n])||void 0===r||r.filter(t=>{var i,s,r,o,a,h;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in t){const n=t.id,o=null===(i=t.filter)||void 0===i?void 0:i.event;return n&&(null===(s=e.ids)||void 0===s?void 0:s.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(r=e.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const i=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===i||i===(null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===n}).map(t=>{if("object"==typeof c&&"ids"in c){const t=c.data,{schema:e,table:i,commit_timestamp:s,type:r,errors:n}=t;c=Object.assign(Object.assign({},{schema:e,table:i,commit_timestamp:s,eventType:r,new:{},old:{},errors:n}),this.J(t))}t.callback(c,i)})}R(){return this.state===at.closed}M(){return this.state===at.joined}U(){return this.state===at.joining}I(){return this.state===at.leaving}m(t){return"chan_reply_"+t}_(t,e,i){const s=t.toLocaleLowerCase(),r={type:s,filter:e,callback:i};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}S(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(t=>{var s;return!((null===(s=t.type)||void 0===s?void 0:s.toLocaleLowerCase())===i&&Lt.isEqual(t.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}T(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.N()}$(t){this._(lt.close,{},t)}A(t){this._(lt.error,{},e=>t(e))}D(){return this.socket.isConnected()&&this.M()}N(t=this.timeout){this.I()||(this.socket.G(this.topic),this.state=at.joining,this.joinPush.resend(t))}J(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=bt(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=bt(t.columns,t.old_record)),e}}const Bt=()=>{};class Ft{constructor(t,e){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Bt,this.ref=0,this.logger=Bt,this.conn=null,this.sendBuffer=[],this.serializer=new yt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.q=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>s(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},this.endPoint=`${t}/${ut.websocket}`,this.httpEndpoint=Tt(t),(null==e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const r=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null==e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null==e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new pt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this.q(null==e?void 0:e.fetch),null==e?void 0:e.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.worker=(null==e?void 0:e.worker)||!1,this.workerUrl=null==e?void 0:e.workerUrl}this.accessToken=(null==e?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=rt),!this.transport)throw Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this.W(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(t=>t.teardown()))}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case nt.connecting:return dt.Connecting;case nt.open:return dt.Open;case nt.closing:return dt.Closing;default:return dt.Closed}}isConnected(){return this.connectionState()===dt.Open}channel(t,e={config:{}}){const i="realtime:"+t,s=this.getChannels().find(t=>t.topic===i);if(s)return s;{const i=new Lt("realtime:"+t,e,this);return this.channels.push(i),i}}push(t){const{topic:e,event:i,payload:s,ref:r}=t,n=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${i} (${r})`,s),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(t=null){let e=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const i={access_token:e,version:"realtime-js/2.11.15"};e&&t.updateJoinPayload(i),t.joinedOnce&&t.M()&&t.C(lt.access_token,{access_token:e})}))}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this.p(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}p(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}G(t){let e=this.channels.find(e=>e.topic===t&&(e.M()||e.U()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}P(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this.H(),this.conn.onerror=t=>this.V(t),this.conn.onmessage=t=>this.K(t),this.conn.onclose=t=>this.Y(t))}K(t){this.decode(t.data,t=>{let{topic:e,event:i,payload:s,ref:r}=t;"phoenix"===e&&"phx_reply"===i&&this.heartbeatCallback("ok"==t.payload.status?"ok":"error"),r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${e} ${i} ${r&&"("+r+")"||""}`,s),Array.from(this.channels).filter(t=>t.F(e)).forEach(t=>t.O(i,s,r)),this.stateChangeCallbacks.message.forEach(e=>e(t))})}H(){this.log("transport","connected to "+this.endpointURL()),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this.X():this.Z(),this.stateChangeCallbacks.open.forEach(t=>t())}Z(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}X(){this.workerUrl?this.log("worker","starting worker for from "+this.workerUrl):this.log("worker","starting default worker");const t=this.tt(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}Y(t){this.log("transport","close",t),this.et(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}V(t){this.log("transport",""+t),this.et(),this.stateChangeCallbacks.error.forEach(e=>e(t))}et(){this.channels.forEach(t=>t.O(lt.error))}W(t,e){if(0===Object.keys(e).length)return t;const i=t.match(/\?/)?"&":"?";return`${t}${i}${new URLSearchParams(e)}`}tt(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class Jt extends Error{constructor(t){super(t),this.it=!0,this.name="StorageError"}}function Mt(t){return"object"==typeof t&&null!==t&&"it"in t}class Gt extends Jt{constructor(t,e,i){super(t),this.name="StorageApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class qt extends Jt{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const zt=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>s(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},Wt=t=>{if(Array.isArray(t))return t.map(t=>Wt(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,i])=>{const s=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[s]=Wt(i)}),e};var Ht=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};const Vt=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);function Kt(t,e,i,r,n,o){return Ht(this,void 0,void 0,function*(){return new Promise((a,h)=>{t(i,((t,e,i,s)=>{const r={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"!==t&&s?((t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)})(s)?(r.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),r.body=JSON.stringify(s)):r.body=s,Object.assign(Object.assign({},r),i)):r})(e,r,n,o)).then(t=>{if(!t.ok)throw t;return(null==r?void 0:r.noResolveJson)?t:t.json()}).then(t=>a(t)).catch(t=>((t,e,i)=>Ht(void 0,void 0,void 0,function*(){const r=yield(n=void 0,o=function*(){return"undefined"==typeof Response?(yield s(()=>Promise.resolve().then(()=>k),void 0)).Response:Response},new(n||(n=Promise))(function(t,e){function i(t){try{r(o.next(t))}catch(i){e(i)}}function s(t){try{r(o.throw(t))}catch(i){e(i)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(t){t(r)})).then(i,s)}r((o=o.call(void 0)).next())}));var n,o;t instanceof r&&!(null==i?void 0:i.noResolveJson)?t.json().then(i=>{const s=t.status||500,r=(null==i?void 0:i.statusCode)||s+"";e(new Gt(Vt(i),s,r))}).catch(t=>{e(new qt(Vt(t),t))}):e(new qt(Vt(t),t))}))(t,h,r))})})}function Yt(t,e,i,s){return Ht(this,void 0,void 0,function*(){return Kt(t,"GET",e,i,s)})}function Xt(t,e,i,s,r){return Ht(this,void 0,void 0,function*(){return Kt(t,"POST",e,s,r,i)})}function Qt(t,e,i,s,r){return Ht(this,void 0,void 0,function*(){return Kt(t,"PUT",e,s,r,i)})}function Zt(t,e,i,s,r){return Ht(this,void 0,void 0,function*(){return Kt(t,"DELETE",e,s,r,i)})}var te=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};const ee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ie={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class se{constructor(t,e={},i,s){this.url=t,this.headers=e,this.bucketId=i,this.fetch=zt(s)}uploadOrUpdate(t,e,i,s){return te(this,void 0,void 0,function*(){try{let r;const n=Object.assign(Object.assign({},ie),s);let o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":n.upsert+""});const a=n.metadata;"undefined"!=typeof Blob&&i instanceof Blob?(r=new FormData,r.append("cacheControl",n.cacheControl),a&&r.append("metadata",this.encodeMetadata(a)),r.append("",i)):"undefined"!=typeof FormData&&i instanceof FormData?(r=i,r.append("cacheControl",n.cacheControl),a&&r.append("metadata",this.encodeMetadata(a))):(r=i,o["cache-control"]="max-age="+n.cacheControl,o["content-type"]=n.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const h=this.st(e),l=this.rt(h),c=yield("PUT"==t?Qt:Xt)(this.fetch,`${this.url}/object/${l}`,r,Object.assign({headers:o},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:h,id:c.Id,fullPath:c.Key},error:null}}catch(r){if(Mt(r))return{data:null,error:r};throw r}})}upload(t,e,i){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(t,e,i,s){return te(this,void 0,void 0,function*(){const r=this.st(t),n=this.rt(r),o=new URL(this.url+"/object/upload/sign/"+n);o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:ie.upsert},s),n=Object.assign(Object.assign({},this.headers),{"x-upsert":e.upsert+""});return"undefined"!=typeof Blob&&i instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",i)):"undefined"!=typeof FormData&&i instanceof FormData?(t=i,t.append("cacheControl",e.cacheControl)):(t=i,n["cache-control"]="max-age="+e.cacheControl,n["content-type"]=e.contentType),{data:{path:r,fullPath:(yield Qt(this.fetch,o.toString(),t,{headers:n})).Key},error:null}}catch(a){if(Mt(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(t,e){return te(this,void 0,void 0,function*(){try{let i=this.rt(t);const s=Object.assign({},this.headers);(null==e?void 0:e.upsert)&&(s["x-upsert"]="true");const r=yield Xt(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:s}),n=new URL(this.url+r.url),o=n.searchParams.get("token");if(!o)throw new Jt("No token returned by API");return{data:{signedUrl:n.toString(),path:t,token:o},error:null}}catch(i){if(Mt(i))return{data:null,error:i};throw i}})}update(t,e,i){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(t,e,i){return te(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,this.url+"/object/move",{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==i?void 0:i.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}})}copy(t,e,i){return te(this,void 0,void 0,function*(){try{return{data:{path:(yield Xt(this.fetch,this.url+"/object/copy",{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==i?void 0:i.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}})}createSignedUrl(t,e,i){return te(this,void 0,void 0,function*(){try{let s=this.rt(t),r=yield Xt(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:e},(null==i?void 0:i.transform)?{transform:i.transform}:{}),{headers:this.headers});const n=(null==i?void 0:i.download)?"&download="+(!0===i.download?"":i.download):"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${n}`)},{data:r,error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}})}createSignedUrls(t,e,i){return te(this,void 0,void 0,function*(){try{const s=yield Xt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),r=(null==i?void 0:i.download)?"&download="+(!0===i.download?"":i.download):"";return{data:s.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${r}`):null})),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}})}download(t,e){return te(this,void 0,void 0,function*(){const i=void 0!==(null==e?void 0:e.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),r=s?"?"+s:"";try{const e=this.rt(t),s=yield Yt(this.fetch,`${this.url}/${i}/${e}${r}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(n){if(Mt(n))return{data:null,error:n};throw n}})}info(t){return te(this,void 0,void 0,function*(){const e=this.rt(t);try{const t=yield Yt(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Wt(t),error:null}}catch(i){if(Mt(i))return{data:null,error:i};throw i}})}exists(t){return te(this,void 0,void 0,function*(){const e=this.rt(t);try{return yield function(t,e,i){return Ht(this,void 0,void 0,function*(){return Kt(t,"HEAD",e,Object.assign(Object.assign({},i),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(Mt(i)&&i instanceof qt){const t=i.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:i}}throw i}})}getPublicUrl(t,e){const i=this.rt(t),s=[],r=(null==e?void 0:e.download)?"download="+(!0===e.download?"":e.download):"";""!==r&&s.push(r);const n=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a="?"+a),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${i}${a}`)}}}remove(t){return te(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(Mt(e))return{data:null,error:e};throw e}})}list(t,e,i){return te(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},ee),e),{prefix:t||""});return{data:yield Xt(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},i),error:null}}catch(s){if(Mt(s))return{data:null,error:s};throw s}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}rt(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}st(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push("width="+t.width),t.height&&e.push("height="+t.height),t.resize&&e.push("resize="+t.resize),t.format&&e.push("format="+t.format),t.quality&&e.push("quality="+t.quality),e.join("&")}}const re={"X-Client-Info":"storage-js/2.10.4"};var ne=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};class oe{constructor(t,e={},i,s){const r=new URL(t);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href,this.headers=Object.assign(Object.assign({},re),e),this.fetch=zt(i)}listBuckets(){return ne(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,this.url+"/bucket",{headers:this.headers}),error:null}}catch(t){if(Mt(t))return{data:null,error:t};throw t}})}getBucket(t){return ne(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(Mt(e))return{data:null,error:e};throw e}})}createBucket(t,e={public:!1}){return ne(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,this.url+"/bucket",{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(Mt(i))return{data:null,error:i};throw i}})}updateBucket(t,e){return ne(this,void 0,void 0,function*(){try{return{data:yield Qt(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(Mt(i))return{data:null,error:i};throw i}})}emptyBucket(t){return ne(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Mt(e))return{data:null,error:e};throw e}})}deleteBucket(t){return ne(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(Mt(e))return{data:null,error:e};throw e}})}}class ae extends oe{constructor(t,e={},i,s){super(t,e,i,s)}from(t){return new se(this.url,this.headers,t,this.fetch)}}let he="";he="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const le={headers:{"X-Client-Info":`supabase-js-${he}/2.53.0`}},ce={schema:"public"},ue={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},de={},fe="2.71.1",ve=3e4,we={"X-Client-Info":"gotrue-js/"+fe},ye="X-Supabase-Api-Version",pe=Date.parse("2024-01-01T00:00:00.0Z"),be=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ge extends Error{constructor(t,e,i){super(t),this.nt=!0,this.name="AuthError",this.status=e,this.code=i}}function me(t){return"object"==typeof t&&null!==t&&"nt"in t}class _e extends ge{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}class je extends ge{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class ke extends ge{constructor(t,e,i,s){super(t,i,s),this.name=e,this.status=i}}class Oe extends ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Se extends ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ee extends ke{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Te extends ke{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xe extends ke{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $e extends ke{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function Pe(t){return me(t)&&"AuthRetryableFetchError"===t.name}class Ae extends ke{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class Ie extends ke{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ue=" \t\n\r=".split(""),Ne=(()=>{const t=Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ue.length;e+=1)t[Ue[e].charCodeAt(0)]=-2;for(let e=0;e<Re.length;e+=1)t[Re[e].charCodeAt(0)]=e;return t})();function De(t,e,i){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(Re[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(Re[t]),e.queuedBits-=6}}function Ce(t,e,i){const s=Ne[t];if(-1>=s){if(-2===s)return;throw Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function Le(t){const e=[],i=t=>{e.push(String.fromCodePoint(t))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},n=t=>{!function(t,e,i){if(0===e.utf8seq){if(127>=t)return void i(t);for(let i=1;6>i;i+=1)if(!(t>>7-i&1)){e.utf8seq=i;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(127>=t)throw Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&i(e.codepoint)}}(t,s,i)};for(let o=0;o<t.length;o+=1)Ce(t.charCodeAt(o),r,n);return e.join("")}function Be(t,e){if(t>127){if(2047>=t)return e(192|t>>6),void e(128|63&t);if(65535>=t)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(1114111>=t)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw Error("Unrecognized Unicode codepoint: "+t.toString(16))}e(t)}function Fe(t){const e=[],i={queue:0,queuedBits:0},s=t=>{e.push(t)};for(let r=0;r<t.length;r+=1)Ce(t.charCodeAt(r),i,s);return new Uint8Array(e)}function Je(t){const e=[],i={queue:0,queuedBits:0},s=t=>{e.push(t)};return t.forEach(t=>De(t,i,s)),De(null,i,s),e.join("")}const Me=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Ge={tested:!1,writable:!1},qe=()=>{if(!Me())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Ge.tested)return Ge.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ge.tested=!0,Ge.writable=!0}catch(e){Ge.tested=!0,Ge.writable=!1}return Ge.writable},ze=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>s(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},We=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},He=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch(s){return i}},Ve=async(t,e)=>{await t.removeItem(e)};class Ke{constructor(){this.promise=new Ke.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}function Ye(t){const e=t.split(".");if(3!==e.length)throw new Ie("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!be.test(e[i]))throw new Ie("JWT not in base64url format");return{header:JSON.parse(Le(e[0])),payload:JSON.parse(Le(e[1])),signature:Fe(e[2]),raw:{header:e[0],payload:e[1]}}}function Xe(t){return("0"+t.toString(16)).substr(-2)}async function Qe(t,e,i=!1){const s=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let i="";for(let s=0;56>s;s++)i+=t.charAt(Math.floor(Math.random()*e));return i}return crypto.getRandomValues(t),Array.from(t,Xe).join("")}();let r=s;i&&(r+="/PASSWORD_RECOVERY"),await We(t,e+"-code-verifier",r);const n=await async function(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=await async function(t){const e=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",e),s=new Uint8Array(i);return Array.from(s).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(s);return[n,s===n?"plain":"s256"]}Ke.promiseConstructor=Promise;const Ze=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,ti=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ei(t){if(!ti.test(t))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ii(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function si(t){return JSON.parse(JSON.stringify(t))}const ri=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ni=[502,503,504];async function oi(t){var e,i;if(!("object"==typeof(i=t)&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json))throw new $e(ri(t),0);if(ni.includes(t.status))throw new $e(ri(t),t.status);let s,r;try{s=await t.json()}catch(o){throw new je(ri(o),o)}const n=function(t){const e=t.headers.get(ye);if(!e)return null;if(!e.match(Ze))return null;try{return new Date(e+"T00:00:00.0Z")}catch(o){return null}}(t);if(n&&n.getTime()>=pe&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new Ae(ri(s),t.status,(null===(e=s.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===r)throw new Oe}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new Ae(ri(s),t.status,s.weak_password.reasons);throw new _e(ri(s),t.status||500,r)}async function ai(t,e,i,s){var r;const n=Object.assign({},null==s?void 0:s.headers);n[ye]||(n[ye]="2024-01-01"),(null==s?void 0:s.jwt)&&(n.Authorization="Bearer "+s.jwt);const o=null!==(r=null==s?void 0:s.query)&&void 0!==r?r:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=await async function(t,e,i,s,r,n){const o=((t,e,i,s)=>{const r={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),{}))})(e,s,0,n);let a;try{a=await t(i,Object.assign({},o))}catch(h){throw new $e(ri(h),0)}if(a.ok||await oi(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(h){await oi(h)}}(t,e,i+a,{headers:n,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(h):{data:Object.assign({},h),error:null}}function hi(t){var e;let i=null;var s;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=(s=t.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:i,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function li(t){const e=hi(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function ci(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function ui(t){return{data:t,error:null}}function di(t){const{action_link:e,email_otp:i,hashed_token:s,redirect_to:r,verification_type:n}=t,o=function(t,e){var i={};for(var s in t)({}).hasOwnProperty.call(t,s)&&0>e.indexOf(s)&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)0>e.indexOf(s[r])&&{}.propertyIsEnumerable.call(t,s[r])&&(i[s[r]]=t[s[r]])}return i}(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:i,hashed_token:s,redirect_to:r,verification_type:n},user:Object.assign({},o)},error:null}}function fi(t){return t}const vi=["global","local","others"];class wi{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=ze(i),this.mfa={listFactors:this.ot.bind(this),deleteFactor:this.ht.bind(this)}}async signOut(t,e=vi[0]){if(0>vi.indexOf(e))throw Error("@supabase/auth-js: Parameter scope must be one of "+vi.join(", "));try{return await ai(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,e={}){try{return await ai(this.fetch,"POST",this.url+"/invite",{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:ci})}catch(i){if(me(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:e}=t,i=function(t,e){var i={};for(var s in t)({}).hasOwnProperty.call(t,s)&&0>e.indexOf(s)&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)0>e.indexOf(s[r])&&{}.propertyIsEnumerable.call(t,s[r])&&(i[s[r]]=t[s[r]])}return i}(t,["options"]),s=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(s.new_email=null==i?void 0:i.newEmail,delete s.newEmail),await ai(this.fetch,"POST",this.url+"/admin/generate_link",{body:s,headers:this.headers,xform:di,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(me(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await ai(this.fetch,"POST",this.url+"/admin/users",{body:t,headers:this.headers,xform:ci})}catch(e){if(me(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,i,s,r,n,o,a;try{const h={nextPage:null,lastPage:0,total:0},l=await ai(this.fetch,"GET",this.url+"/admin/users",{headers:this.headers,noResolveJson:!0,query:{page:null!==(i=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==i?i:"",per_page:null!==(r=null===(s=null==t?void 0:t.perPage)||void 0===s?void 0:s.toString())&&void 0!==r?r:""},xform:fi});if(l.error)throw l.error;const c=await l.json(),u=null!==(n=l.headers.get("x-total-count"))&&void 0!==n?n:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),i=JSON.parse(t.split(";")[1].split("=")[1]);h[i+"Page"]=e}),h.total=parseInt(u)),{data:Object.assign(Object.assign({},c),h),error:null}}catch(h){if(me(h))return{data:{users:[]},error:h};throw h}}async getUserById(t){ei(t);try{return await ai(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:ci})}catch(e){if(me(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){ei(t);try{return await ai(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:ci})}catch(i){if(me(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,e=!1){ei(t);try{return await ai(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:ci})}catch(i){if(me(i))return{data:{user:null},error:i};throw i}}async ot(t){ei(t.userId);try{const{data:e,error:i}=await ai(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:i}}catch(e){if(me(e))return{data:null,error:e};throw e}}async ht(t){ei(t.userId),ei(t.id);try{return{data:await ai(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(me(e))return{data:null,error:e};throw e}}}function yi(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}const pi=!!(globalThis&&qe()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class bi extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class gi extends bi{}async function mi(t,e,i){const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===e)throw new gi(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(pi)try{await globalThis.navigator.locks.query()}catch(r){}return await i()}try{return await i()}finally{}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"ct",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.ct}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const _i={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:we,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ji(t,e,i){return await i()}const ki={};class Oi{constructor(t){var e,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oi.nextInstanceID,Oi.nextInstanceID+=1,this.instanceID>0&&Me();const s=Object.assign(Object.assign({},_i),t);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new wi({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=ze(s.fetch),this.lock=s.lock||ji,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Me()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=mi:this.lock=ji,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.ut.bind(this),enroll:this.dt.bind(this),unenroll:this.ft.bind(this),challenge:this.vt.bind(this),listFactors:this.ot.bind(this),challengeAndVerify:this.wt.bind(this),getAuthenticatorAssuranceLevel:this.yt.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:qe()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=yi(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=yi(this.memoryStorage)),Me()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",async t=>{this.bt("received broadcast notification from other tab or client",t),await this._t(t.data.event,t.data.session,!1)})}this.initialize()}get jwks(){var t,e;return null!==(e=null===(t=ki[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){ki[this.storageKey]=Object.assign(Object.assign({},ki[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=ki[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ki[this.storageKey]=Object.assign(Object.assign({},ki[this.storageKey]),{cachedAt:t})}bt(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${fe}) ${(new Date).toISOString()}`,...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.jt(-1,async()=>await this.kt()))()),await this.initializePromise}async kt(){var t;try{const e=function(t){const e={},i=new URL(t);if(i.hash&&"#"===i.hash[0])try{new URLSearchParams(i.hash.substring(1)).forEach((t,i)=>{e[i]=t})}catch(s){}return i.searchParams.forEach((t,i)=>{e[i]=t}),e}(window.location.href);let i="none";if(this.Ot(e)?i="implicit":await this.St(e)&&(i="pkce"),Me()&&this.detectSessionInUrl&&"none"!==i){const{data:s,error:r}=await this.Et(e,i);if(r){if(this.bt("#_initialize()","error detecting session from URL",r),function(t){return me(t)&&"AuthImplicitGrantRedirectError"===t.name}(r)){const e=null===(t=r.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:r}}return await this.Tt(),{error:r}}const{session:n,redirectType:o}=s;return this.bt("#_initialize()","detected session in URL",n,"redirect type",o),await this.xt(n),setTimeout(async()=>{"recovery"===o?await this._t("PASSWORD_RECOVERY",n):await this._t("SIGNED_IN",n)},0),{error:null}}return await this.$t(),{error:null}}catch(e){return me(e)?{error:e}:{error:new je("Unexpected error during initialization",e)}}finally{await this.Pt(),this.bt("#_initialize()","end")}}async signInAnonymously(t){var e,i,s;try{const r=await ai(this.fetch,"POST",this.url+"/signup",{headers:this.headers,body:{data:null!==(i=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(s=null==t?void 0:t.options)||void 0===s?void 0:s.captchaToken}},xform:hi}),{data:n,error:o}=r;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.xt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(r){if(me(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(t){var e,i,s;try{let r;if("email"in t){const{email:i,password:s,options:n}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Qe(this.storage,this.storageKey)),r=await ai(this.fetch,"POST",this.url+"/signup",{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:i,password:s,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:hi})}else{if(!("phone"in t))throw new Ee("You must provide either an email or phone number and a password");{const{phone:e,password:n,options:o}=t;r=await ai(this.fetch,"POST",this.url+"/signup",{headers:this.headers,body:{phone:e,password:n,data:null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:hi})}}const{data:n,error:o}=r;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.xt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(r){if(me(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:i,password:s,options:r}=t;e=await ai(this.fetch,"POST",this.url+"/token?grant_type=password",{headers:this.headers,body:{email:i,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:li})}else{if(!("phone"in t))throw new Ee("You must provide either an email or phone number and a password");{const{phone:i,password:s,options:r}=t;e=await ai(this.fetch,"POST",this.url+"/token?grant_type=password",{headers:this.headers,body:{phone:i,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:li})}}const{data:i,error:s}=e;return s?{data:{user:null,session:null},error:s}:i&&i.session&&i.user?(i.session&&(await this.xt(i.session),await this._t("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Se}}catch(e){if(me(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,i,s,r;return await this.At(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(s=t.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(r=t.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.jt(-1,async()=>this.It(t))}async signInWithWeb3(t){const{chain:e}=t;if("solana"===e)return await this.signInWithSolana(t);throw Error(`@supabase/auth-js: Unsupported chain "${e}"`)}async signInWithSolana(t){var e,i,s,r,n,o,a,h,l,c,u,d;let f,v;if("message"in t)f=t.message,v=t.signature;else{const{chain:u,wallet:d,statement:w,options:y}=t;let p;if(Me())if("object"==typeof d)p=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");p=t.solana}else{if("object"!=typeof d||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=d}const b=new URL(null!==(e=null==y?void 0:y.url)&&void 0!==e?e:window.location.href);if("signIn"in p&&p.signIn){const t=await p.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),w?{statement:w}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),v=e.signature}else{if(!("signMessage"in p&&"function"==typeof p.signMessage&&"publicKey"in p&&"object"==typeof p&&p.publicKey&&"toBase58"in p.publicKey&&"function"==typeof p.publicKey.toBase58))throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[b.host+" wants you to sign in with your Solana account:",p.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1","URI: "+b.href,"Issued At: "+(null!==(s=null===(i=null==y?void 0:y.signInWithSolana)||void 0===i?void 0:i.issuedAt)&&void 0!==s?s:(new Date).toISOString()),...(null===(r=null==y?void 0:y.signInWithSolana)||void 0===r?void 0:r.notBefore)?["Not Before: "+y.signInWithSolana.notBefore]:[],...(null===(n=null==y?void 0:y.signInWithSolana)||void 0===n?void 0:n.expirationTime)?["Expiration Time: "+y.signInWithSolana.expirationTime]:[],...(null===(o=null==y?void 0:y.signInWithSolana)||void 0===o?void 0:o.chainId)?["Chain ID: "+y.signInWithSolana.chainId]:[],...(null===(a=null==y?void 0:y.signInWithSolana)||void 0===a?void 0:a.nonce)?["Nonce: "+y.signInWithSolana.nonce]:[],...(null===(h=null==y?void 0:y.signInWithSolana)||void 0===h?void 0:h.requestId)?["Request ID: "+y.signInWithSolana.requestId]:[],...(null===(c=null===(l=null==y?void 0:y.signInWithSolana)||void 0===l?void 0:l.resources)||void 0===c?void 0:c.length)?["Resources",...y.signInWithSolana.resources.map(t=>"- "+t)]:[]].join("\n");const t=await p.signMessage((new TextEncoder).encode(f),"utf8");if(!(t&&t instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=t}}try{const{data:e,error:i}=await ai(this.fetch,"POST",this.url+"/token?grant_type=web3",{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Je(v)},(null===(u=t.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:hi});if(i)throw i;return e&&e.session&&e.user?(e.session&&(await this.xt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign({},e),error:i}):{data:{user:null,session:null},error:new Se}}catch(w){if(me(w))return{data:{user:null,session:null},error:w};throw w}}async It(t){const e=await He(this.storage,this.storageKey+"-code-verifier"),[i,s]=(null!=e?e:"").split("/");try{const{data:e,error:r}=await ai(this.fetch,"POST",this.url+"/token?grant_type=pkce",{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:hi});if(await Ve(this.storage,this.storageKey+"-code-verifier"),r)throw r;return e&&e.session&&e.user?(e.session&&(await this.xt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=s?s:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Se}}catch(r){if(me(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(t){try{const{options:e,provider:i,token:s,access_token:r,nonce:n}=t,o=await ai(this.fetch,"POST",this.url+"/token?grant_type=id_token",{headers:this.headers,body:{provider:i,id_token:s,access_token:r,nonce:n,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:hi}),{data:a,error:h}=o;return h?{data:{user:null,session:null},error:h}:a&&a.session&&a.user?(a.session&&(await this.xt(a.session),await this._t("SIGNED_IN",a.session)),{data:a,error:h}):{data:{user:null,session:null},error:new Se}}catch(e){if(me(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,i,s,r,n;try{if("email"in t){const{email:s,options:r}=t;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await Qe(this.storage,this.storageKey));const{error:a}=await ai(this.fetch,"POST",this.url+"/otp",{headers:this.headers,body:{email:s,data:null!==(e=null==r?void 0:r.data)&&void 0!==e?e:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:i}=t,{data:o,error:a}=await ai(this.fetch,"POST",this.url+"/otp",{headers:this.headers,body:{phone:e,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},channel:null!==(n=null==i?void 0:i.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Ee("You must provide either an email or phone number.")}catch(o){if(me(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,i;try{let s,r;"options"in t&&(s=null===(e=t.options)||void 0===e?void 0:e.redirectTo,r=null===(i=t.options)||void 0===i?void 0:i.captchaToken);const{data:n,error:o}=await ai(this.fetch,"POST",this.url+"/verify",{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:hi});if(o)throw o;if(!n)throw Error("An error occurred on token verification.");const a=n.session,h=n.user;return(null==a?void 0:a.access_token)&&(await this.xt(a),await this._t("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(s){if(me(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var e,i,s;try{let r=null,n=null;return"pkce"===this.flowType&&([r,n]=await Qe(this.storage,this.storageKey)),await ai(this.fetch,"POST",this.url+"/sso",{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==i?i:void 0}),(null===(s=null==t?void 0:t.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:n}),headers:this.headers,xform:ui})}catch(r){if(me(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this.jt(-1,async()=>await this.Rt())}async Rt(){try{return await this.Ut(async t=>{const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new Oe;const{error:s}=await ai(this.fetch,"GET",this.url+"/reauthenticate",{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(me(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=this.url+"/resend";if("email"in t){const{email:i,type:s,options:r}=t,{error:n}=await ai(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in t){const{phone:i,type:s,options:r}=t,{data:n,error:o}=await ai(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new Ee("You must provide either an email or phone number and a type")}catch(e){if(me(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this.jt(-1,async()=>this.Ut(async t=>t))}async jt(t,e){this.bt("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch(t){}})()),i}return await this.lock("lock:"+this.storageKey,t,async()=>{this.bt("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.bt("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.bt("#_acquireLock","end")}}async Ut(t){this.bt("#_useSession","begin");try{const e=await this.Nt();return await t(e)}finally{this.bt("#_useSession","end")}}async Nt(){this.bt("#__loadSession()","begin"),this.lockAcquired||this.bt("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null;const e=await He(this.storage,this.storageKey);if(this.bt("#getSession()","session from storage",e),null!==e&&(this.Dt(e)?t=e:(this.bt("#getSession()","session from storage is not valid"),await this.Tt())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&9e4>1e3*t.expires_at-Date.now();if(this.bt("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const e=await He(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=ii()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,i,s)=>(e||"user"!==i||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,i,s))})}return{data:{session:t},error:null}}const{session:s,error:r}=await this.Ct(t.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this.bt("#__loadSession()","end")}}async getUser(t){return t?await this.Lt(t):(await this.initializePromise,await this.jt(-1,async()=>await this.Lt()))}async Lt(t){try{return t?await ai(this.fetch,"GET",this.url+"/user",{headers:this.headers,jwt:t,xform:ci}):await this.Ut(async t=>{var e,i,s;const{data:r,error:n}=t;if(n)throw n;return(null===(e=r.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await ai(this.fetch,"GET",this.url+"/user",{headers:this.headers,jwt:null!==(s=null===(i=r.session)||void 0===i?void 0:i.access_token)&&void 0!==s?s:void 0,xform:ci}):{data:{user:null},error:new Oe}})}catch(e){if(me(e))return function(t){return me(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this.Tt(),await Ve(this.storage,this.storageKey+"-code-verifier")),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.jt(-1,async()=>await this.Bt(t,e))}async Bt(t,e={}){try{return await this.Ut(async i=>{const{data:s,error:r}=i;if(r)throw r;if(!s.session)throw new Oe;const n=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await Qe(this.storage,this.storageKey));const{data:h,error:l}=await ai(this.fetch,"PUT",this.url+"/user",{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:n.access_token,xform:ci});if(l)throw l;return n.user=h.user,await this.xt(n),await this._t("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(i){if(me(i))return{data:{user:null},error:i};throw i}}async setSession(t){return await this.initializePromise,await this.jt(-1,async()=>await this.Ft(t))}async Ft(t){try{if(!t.access_token||!t.refresh_token)throw new Oe;const e=Date.now()/1e3;let i=e,s=!0,r=null;const{payload:n}=Ye(t.access_token);if(n.exp&&(i=n.exp,s=e>=i),s){const{session:e,error:i}=await this.Ct(t.refresh_token);if(i)return{data:{user:null,session:null},error:i};if(!e)return{data:{user:null,session:null},error:null};r=e}else{const{data:s,error:n}=await this.Lt(t.access_token);if(n)throw n;r={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:i-e,expires_at:i},await this.xt(r),await this._t("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(e){if(me(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this.jt(-1,async()=>await this.Jt(t))}async Jt(t){try{return await this.Ut(async e=>{var i;if(!t){const{data:s,error:r}=e;if(r)throw r;t=null!==(i=s.session)&&void 0!==i?i:void 0}if(!(null==t?void 0:t.refresh_token))throw new Oe;const{session:s,error:r}=await this.Ct(t.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(me(e))return{data:{user:null,session:null},error:e};throw e}}async Et(t,e){try{if(!Me())throw new Te("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Te(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new xe("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Te("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.bt("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new xe("No code detected.");const{data:e,error:i}=await this.It(t.code);if(i)throw i;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:s,access_token:r,refresh_token:n,expires_in:o,expires_at:a,token_type:h}=t;if(!(r&&o&&n&&h))throw new Te("No session defined in URL");const l=Math.round(Date.now()/1e3),c=parseInt(o);let u=l+c;a&&(u=parseInt(a));const{data:d,error:f}=await this.Lt(r);if(f)throw f;const v={provider_token:i,provider_refresh_token:s,access_token:r,expires_in:c,expires_at:u,refresh_token:n,token_type:h,user:d.user};return window.location.hash="",this.bt("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:t.type},error:null}}catch(i){if(me(i))return{data:{session:null,redirectType:null},error:i};throw i}}Ot(t){return!(!t.access_token&&!t.error_description)}async St(t){const e=await He(this.storage,this.storageKey+"-code-verifier");return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.jt(-1,async()=>await this.Mt(t))}async Mt({scope:t}={scope:"global"}){return await this.Ut(async e=>{var i;const{data:s,error:r}=e;if(r)return{error:r};const n=null===(i=s.session)||void 0===i?void 0:i.access_token;if(n){const{error:e}=await this.admin.signOut(n,t);if(e&&(!function(t){return me(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this.Tt(),await Ve(this.storage,this.storageKey+"-code-verifier")),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),i={id:e,callback:t,unsubscribe:()=>{this.bt("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.bt("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(async()=>{await this.initializePromise,await this.jt(-1,async()=>{this.Gt(e)})})(),{data:{subscription:i}}}async Gt(t){return await this.Ut(async e=>{var i,s;try{const{data:{session:s},error:r}=e;if(r)throw r;await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",s)),this.bt("INITIAL_SESSION","callback id",t,"session",s)}catch(r){await(null===(s=this.stateChangeEmitters.get(t))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this.bt("INITIAL_SESSION","callback id",t,"error",r)}})}async resetPasswordForEmail(t,e={}){let i=null,s=null;"pkce"===this.flowType&&([i,s]=await Qe(this.storage,this.storageKey,!0));try{return await ai(this.fetch,"POST",this.url+"/recover",{body:{email:t,code_challenge:i,code_challenge_method:s,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(me(r))return{data:null,error:r};throw r}}async getUserIdentities(){var t;try{const{data:e,error:i}=await this.getUser();if(i)throw i;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(me(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:i,error:s}=await this.Ut(async e=>{var i,s,r,n,o;const{data:a,error:h}=e;if(h)throw h;const l=await this.qt(this.url+"/user/identities/authorize",t.provider,{redirectTo:null===(i=t.options)||void 0===i?void 0:i.redirectTo,scopes:null===(s=t.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await ai(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==o?o:void 0})});if(s)throw s;return Me()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:t.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(me(i))return{data:{provider:t.provider,url:null},error:i};throw i}}async unlinkIdentity(t){try{return await this.Ut(async e=>{var i,s;const{data:r,error:n}=e;if(n)throw n;return await ai(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(i=r.session)||void 0===i?void 0:i.access_token)&&void 0!==s?s:void 0})})}catch(e){if(me(e))return{data:null,error:e};throw e}}async zt(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.bt(e,"begin");try{const r=Date.now();return await(i=async i=>(i>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,i-1)),this.bt(e,"refreshing attempt",i),await ai(this.fetch,"POST",this.url+"/token?grant_type=refresh_token",{body:{refresh_token:t},headers:this.headers,xform:hi})),s=(t,e)=>{const i=200*Math.pow(2,t);return e&&Pe(e)&&Date.now()+i-r<ve},new Promise((t,e)=>{(async()=>{for(let n=0;1/0>n;n++)try{const e=await i(n);if(!s(n,null))return void t(e)}catch(r){if(!s(n,r))return void e(r)}})()}))}catch(r){if(this.bt(e,"error",r),me(r))return{data:{session:null,user:null},error:r};throw r}finally{this.bt(e,"end")}var i,s}Dt(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async At(t,e){const i=await this.qt(this.url+"/authorize",t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.bt("#_handleProviderSignIn()","provider",t,"options",e,"url",i),Me()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async $t(){var t,e;const i="#_recoverAndRefresh()";this.bt(i,"begin");try{const r=await He(this.storage,this.storageKey);if(r&&this.userStorage){let e=await He(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:r.user},await We(this.userStorage,this.storageKey+"-user",e)),r.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:ii()}else if(r&&!r.user&&!r.user){const t=await He(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(r.user=t.user,await Ve(this.storage,this.storageKey+"-user"),await We(this.storage,this.storageKey,r)):r.user=ii()}if(this.bt(i,"session from storage",r),!this.Dt(r))return this.bt(i,"session is not valid"),void(null!==r&&await this.Tt());const n=9e4>1e3*(null!==(e=r.expires_at)&&void 0!==e?e:1/0)-Date.now();if(this.bt(i,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:t}=await this.Ct(r.refresh_token);t&&(Pe(t)||(this.bt(i,"refresh failed with a non-retryable error, removing the session",t),await this.Tt()))}}else if(r.user&&!0===r.user.Wt)try{const{data:t,error:e}=await this.Lt(r.access_token);!e&&(null==t?void 0:t.user)?(r.user=t.user,await this.xt(r),await this._t("SIGNED_IN",r)):this.bt(i,"could not get user data, skipping SIGNED_IN notification")}catch(s){this.bt(i,"error getting user data, skipping SIGNED_IN notification",s)}else await this._t("SIGNED_IN",r)}catch(r){return void this.bt(i,"error",r)}finally{this.bt(i,"end")}}async Ct(t){var e,i;if(!t)throw new Oe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this.bt(s,"begin");try{this.refreshingDeferred=new Ke;const{data:e,error:i}=await this.zt(t);if(i)throw i;if(!e.session)throw new Oe;await this.xt(e.session),await this._t("TOKEN_REFRESHED",e.session);const s={session:e.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(r){if(this.bt(s,"error",r),me(r)){const t={session:null,error:r};return Pe(r)||await this.Tt(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(i=this.refreshingDeferred)||void 0===i||i.reject(r),r}finally{this.refreshingDeferred=null,this.bt(s,"end")}}async _t(t,e,i=!0){const s=`#_notifyAllSubscribers(${t})`;this.bt(s,"begin",e,"broadcast = "+i);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const s=[],r=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,e)}catch(r){s.push(r)}});if(await Promise.all(r),s.length>0){for(let t=0;t<s.length;t+=1);throw s[0]}}finally{this.bt(s,"end")}}async xt(t){this.bt("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),i=e.user&&!0===e.user.Wt;if(this.userStorage){!i&&e.user&&await We(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const s=si(t);await We(this.storage,this.storageKey,s)}else{const t=si(e);await We(this.storage,this.storageKey,t)}}async Tt(){this.bt("#_removeSession()"),await Ve(this.storage,this.storageKey),await Ve(this.storage,this.storageKey+"-code-verifier"),await Ve(this.storage,this.storageKey+"-user"),this.userStorage&&await Ve(this.userStorage,this.storageKey+"-user"),await this._t("SIGNED_OUT",null)}Ht(){this.bt("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Me()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}async Vt(){await this.Kt(),this.bt("#_startAutoRefresh()");const t=setInterval(()=>this.Yt(),ve);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this.Yt()},0)}async Kt(){this.bt("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this.Ht(),await this.Vt()}async stopAutoRefresh(){this.Ht(),await this.Kt()}async Yt(){this.bt("#_autoRefreshTokenTick()","begin");try{await this.jt(0,async()=>{try{const e=Date.now();try{return await this.Ut(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at)return void this.bt("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*i.expires_at-e)/ve);this.bt("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s>3||await this.Ct(i.refresh_token)})}catch(t){}}finally{this.bt("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof bi))throw t;this.bt("auto refresh token tick lock not available")}}async Pt(){if(this.bt("#_handleVisibilityChange()"),!Me()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this.Xt(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this.Xt(!0)}catch(t){}}async Xt(t){const e=`#_onVisibilityChanged(${t})`;this.bt(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.Vt(),t||(await this.initializePromise,await this.jt(-1,async()=>{"visible"===document.visibilityState?await this.$t():this.bt(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.Kt()}async qt(t,e,i){const s=["provider="+encodeURIComponent(e)];if((null==i?void 0:i.redirectTo)&&s.push("redirect_to="+encodeURIComponent(i.redirectTo)),(null==i?void 0:i.scopes)&&s.push("scopes="+encodeURIComponent(i.scopes)),"pkce"===this.flowType){const[t,e]=await Qe(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:""+encodeURIComponent(t),code_challenge_method:""+encodeURIComponent(e)});s.push(i.toString())}if(null==i?void 0:i.queryParams){const t=new URLSearchParams(i.queryParams);s.push(t.toString())}return(null==i?void 0:i.skipBrowserRedirect)&&s.push("skip_http_redirect="+i.skipBrowserRedirect),`${t}?${s.join("&")}`}async ft(t){try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;return r?{data:null,error:r}:await ai(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token})})}catch(e){if(me(e))return{data:null,error:e};throw e}}async dt(t){try{return await this.Ut(async e=>{var i,s;const{data:r,error:n}=e;if(n)return{data:null,error:n};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:h}=await ai(this.fetch,"POST",this.url+"/factors",{body:o,headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token});return h?{data:null,error:h}:("totp"===t.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code="data:image/svg+xml;utf-8,"+a.totp.qr_code),{data:a,error:null})})}catch(e){if(me(e))return{data:null,error:e};throw e}}async ut(t){return this.jt(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;if(r)return{data:null,error:r};const{data:n,error:o}=await ai(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token});return o?{data:null,error:o}:(await this.xt(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._t("MFA_CHALLENGE_VERIFIED",n),{data:n,error:o})})}catch(e){if(me(e))return{data:null,error:e};throw e}})}async vt(t){return this.jt(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;return r?{data:null,error:r}:await ai(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token})})}catch(e){if(me(e))return{data:null,error:e};throw e}})}async wt(t){const{data:e,error:i}=await this.vt({factorId:t.factorId});return i?{data:null,error:i}:await this.ut({factorId:t.factorId,challengeId:e.id,code:t.code})}async ot(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const i=(null==t?void 0:t.factors)||[],s=i.filter(t=>"totp"===t.factor_type&&"verified"===t.status),r=i.filter(t=>"phone"===t.factor_type&&"verified"===t.status);return{data:{all:i,totp:s,phone:r},error:null}}async yt(){return this.jt(-1,async()=>await this.Ut(async t=>{var e,i;const{data:{session:s},error:r}=t;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Ye(s.access_token);let o=null;n.aal&&(o=n.aal);let a=o;return(null!==(i=null===(e=s.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==i?i:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(t,e={keys:[]}){let i=e.keys.find(e=>e.kid===t);if(i)return i;const s=Date.now();if(i=this.jwks.keys.find(e=>e.kid===t),i&&this.jwks_cached_at+6e5>s)return i;const{data:r,error:n}=await ai(this.fetch,"GET",this.url+"/.well-known/jwks.json",{headers:this.headers});if(n)throw n;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=s,i=r.keys.find(e=>e.kid===t),i||null):null}async getClaims(t,e={}){try{let i=t;if(!i){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};i=t.session.access_token}const{header:s,payload:r,signature:n,raw:{header:o,payload:a}}=Ye(i);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw Error("Missing exp claim");if(Math.floor(Date.now()/1e3)>=t)throw Error("JWT has expired")}(r.exp);const h=s.alg&&!s.alg.startsWith("HS")&&s.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(s.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!h){const{error:t}=await this.getUser(i);if(t)throw t;return{data:{claims:r,header:s,signature:n},error:null}}const l=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(s.alg),c=await crypto.subtle.importKey("jwk",h,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,c,n,function(t){const e=[];return function(t,e){for(let i=0;i<t.length;i+=1){let s=t.charCodeAt(i);if(s>55295&&56319>=s){const e=1024*(s-55296)&65535;s=65536+(t.charCodeAt(i+1)-56320&65535|e),i+=1}Be(s,e)}}(t,t=>e.push(t)),new Uint8Array(e)}(`${o}.${a}`))))throw new Ie("Invalid JWT signature");return{data:{claims:r,header:s,signature:n},error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}}}Oi.nextInstanceID=0;const Si=Oi;class Ei extends Si{constructor(t){super(t)}}class Ti{constructor(t,e,i){var s,r,n;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw Error("supabaseUrl is required.");if(!e)throw Error("supabaseKey is required.");const o=(a=t).endsWith("/")?a:a+"/";var a;const h=new URL(o);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const l=`sb-${h.hostname.split(".")[0]}-auth-token`,c=function(t,e){var i,s;const{db:r,auth:n,realtime:o,global:a}=t,{db:h,auth:l,realtime:c,global:u}=e,d={db:Object.assign(Object.assign({},h),r),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},c),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(i=null==u?void 0:u.headers)&&void 0!==i?i:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:()=>{return t=this,i=function*(){return""},new((e=void 0)||(e=Promise))(function(s,r){function n(t){try{a(i.next(t))}catch(e){r(e)}}function o(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(n,o)}a((i=i.call(t)).next())});var t,e,i}};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=i?i:{},{db:ce,realtime:de,auth:Object.assign(Object.assign({},ue),{storageKey:l}),global:le});this.storageKey=null!==(s=c.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(r=c.global.headers)&&void 0!==r?r:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${e+""} is not possible`)}})):this.auth=this.Qt(null!==(n=c.auth)&&void 0!==n?n:{},this.headers,c.global.fetch),this.fetch=((t,e,i)=>{const s=(t=>{let e;return e=t||("undefined"==typeof fetch?g:fetch),(...t)=>e(...t)})(i),r="undefined"==typeof Headers?m:Headers;return(i,n)=>{return a=function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let h=new r(null==n?void 0:n.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization","Bearer "+a),s(i,Object.assign(Object.assign({},n),{headers:h}))},new((o=void 0)||(o=Promise))(function(t,e){function i(t){try{r(a.next(t))}catch(i){e(i)}}function s(t){try{r(a.throw(t))}catch(i){e(i)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o(function(t){t(r)})).then(i,s)}r((a=a.call(void 0)).next())});var o,a}})(e,this.Zt.bind(this),c.global.fetch),this.realtime=this.te(Object.assign({headers:this.headers,accessToken:this.Zt.bind(this)},c.realtime)),this.rest=new Q(new URL("rest/v1",h).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new ae(this.storageUrl.href,this.headers,this.fetch,null==i?void 0:i.storage),c.accessToken||this.ee()}get functions(){return new c(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}Zt(){var t,e,i,s,r;return i=this,r=function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return null!==(e=null===(t=i.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null},new((s=void 0)||(s=Promise))(function(t,e){function n(t){try{a(r.next(t))}catch(i){e(i)}}function o(t){try{a(r.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s(function(t){t(i)})).then(n,o)}a((r=r.call(i)).next())})}Qt({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:s,storageKey:r,flowType:n,lock:o,debug:a},h,l){const c={Authorization:"Bearer "+this.supabaseKey,apikey:""+this.supabaseKey};return new Ei({url:this.authUrl.href,headers:Object.assign(Object.assign({},c),h),storageKey:r,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:s,flowType:n,lock:o,debug:a,fetch:l,hasCustomAuthorizationHeader:"Authorization"in this.headers})}te(t){return new Ft(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}ee(){return this.auth.onAuthStateChange((t,e)=>{this.ie(t,"CLIENT",null==e?void 0:e.access_token)})}ie(t,e,i){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===i?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=i}}const xi=(t,e,i)=>new Ti(t,e,i);!function(){if("undefined"!=typeof window||"undefined"==typeof process||void 0===process.version||null===process.version)return!1;const t=process.version.match(/^v(\d+)\./);t&&t[1]}();export{s as _,xi as c};
